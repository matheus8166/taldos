<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gerador de Orçamentos</title>
    
    <!-- Melhoras para iPhone (Web App) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Orçamentos">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/2563eb/ffffff?text=Orc">

    <!-- Bibliotecas para Gerar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilo para a barra de rolagem */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="container mx-auto p-4 md:p-8 pb-24 lg:pb-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-400">Gerador de Orçamentos Taldos</h1>
            <p class="text-gray-400 mt-2">Crie e envie orçamentos de forma rápida e eficiente.</p>
        </header>

        <main class="lg:grid lg:grid-cols-2 lg:gap-8">

            <!-- Coluna da Esquerda: Produtos e Configurações -->
            <div id="products-view" class="bg-gray-800 p-6 rounded-lg shadow-lg flex flex-col">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">1. Configurações e Produtos</h2>

                <!-- Seção de Configurações -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="customerName" class="block text-sm font-medium text-gray-300 mb-1">Nome do Cliente:</label>
                        <input type="text" id="customerName" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="João da Silva">
                    </div>
                    <div>
                        <label for="customerCity" class="block text-sm font-medium text-gray-300 mb-1">Cidade do Cliente:</label>
                        <input type="text" id="customerCity" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="São Paulo">
                    </div>
                    <div>
                        <label for="pesoRate" class="block text-sm font-medium text-gray-300 mb-1">Cotação do Peso (ARS):</label>
                        <input type="number" id="pesoRate" step="0.01" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Ex: 5.50">
                    </div>
                     <div>
                        <label for="fretePorPar" class="block text-sm font-medium text-gray-300 mb-1">Valor Frete (por par):</label>
                        <input type="number" id="fretePorPar" step="0.01" value="3.00" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <!-- Seção de Busca de Produtos -->
                <div class="flex-grow flex flex-col">
                    <label for="searchProduct" class="block text-sm font-medium text-gray-300 mb-1">Pesquisar Produto:</label>
                    <input type="text" id="searchProduct" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 mb-4 focus:ring-blue-500 focus:border-blue-500" placeholder="Digite a referência ou nome do produto">

                    <div id="productList" class="flex-grow overflow-y-auto bg-gray-900/50 rounded-lg p-2 h-96">
                        <!-- Produtos serão inseridos aqui via JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Coluna da Direita: Orçamento Atual -->
            <div id="budget-view" class="bg-gray-800 p-6 rounded-lg shadow-lg hidden lg:flex lg:flex-col">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">2. Orçamento Atual</h2>
                
                <div class="overflow-x-auto h-[35rem] mb-4">
                    <table class="min-w-full">
                        <thead class="bg-gray-700 sticky top-0">
                            <tr>
                                <th class="text-left p-3">Produto</th>
                                <th class="text-center p-3">Qtd.</th>
                                <th class="text-right p-3">Subtotal</th>
                                <th class="text-center p-3">Ação</th>
                            </tr>
                        </thead>
                        <tbody id="budgetItems">
                           <tr id="empty-message">
                               <td colspan="4" class="text-center text-gray-400 p-8">Nenhum produto adicionado ainda.</td>
                           </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Seção de Resumo -->
                <div class="bg-gray-900/70 p-4 rounded-lg space-y-3">
                    <h3 class="text-xl font-semibold mb-2">Resumo do Pedido</h3>
                    <div class="flex justify-between items-center text-lg">
                        <span class="text-gray-300">Subtotal Produtos:</span>
                        <span id="subtotalProducts" class="font-bold text-blue-300">R$ 0,00</span>
                    </div>
                     <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-400">Custo Nota Fiscal (R$ 1,00/par):</span>
                        <span id="costNota" class="font-semibold text-gray-400">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-400">Custo Frete:</span>
                        <span id="costFrete" class="font-semibold text-gray-400">R$ 0,00</span>
                    </div>
                    <hr class="border-gray-600 my-2">
                    <div class="flex justify-between items-center text-2xl">
                        <span class="text-white font-bold">TOTAL (BRL):</span>
                        <span id="grandTotalBRL" class="font-bold text-green-400">R$ 0,00</span>
                    </div>
                    <div class="flex justify-between items-center text-xl">
                        <span class="text-gray-300">TOTAL (ARS):</span>
                        <span id="grandTotalARS" class="font-semibold text-yellow-400">$ 0,00</span>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="flex flex-col md:flex-row gap-4 mt-6">
                    <button id="generatePDF" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Gerar PDF
                    </button>
                    <button id="sendWhatsApp" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.655 4.357 1.849 6.067l-1.289 4.685 4.793-1.251zm5.48-6.305c-.079-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.371-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01s-.521.074-.792.372c-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.289.173-1.413z"></path></svg>
                        WhatsApp
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 p-2 flex justify-around z-50 shadow-lg">
        <button id="show-products-btn" class="flex flex-col items-center justify-center text-center text-gray-300 font-semibold p-2 w-full rounded-md transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
            <span>Produtos</span>
        </button>
        <button id="show-budget-btn" class="flex flex-col items-center justify-center text-center text-gray-300 font-semibold p-2 w-full rounded-md relative transition-colors duration-200">
             <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            <span>Orçamento</span>
            <span id="budget-count-badge" class="absolute top-1 right-5 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden transform translate-x-1/2 -translate-y-1/2">0</span>
        </button>
    </nav>

    <script>
        const { jsPDF } = window.jspdf;

        // --- DADOS GLOBAIS ---
        
        // Logo da Taldos em formato Base64 para ser embutida no PDF
        const logoBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAA+CAYAAAB2g0G8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAqZSURBVHgB7Z1tctxI0sc3XqJbVVXVVb1rL9D2sQ0IWEAQgYEEJAAGsAE2QAYIgU1YjBcmwQahZ3pXvYqrq6uqq6q1d8+u9s/Mzs72sR5Ikv/8ycyOfr5+fnd6tG9IkvwdMpmMnp6efp2e3k5nZ2f0+XzW6O/vR2dnZ5xMJuPz8/P6fD6Pjo6O+Pj4WOOnn37i4+NjnJ2d8fHxMX4sX9c1MvT9Y3R3d+P9/X3jL1+jXw99f3+f+F7X3d3doq9fP7a3t+O1117jq6++oq9fv+b83//93+N///d/WzQ5/L///S/v7+/j8/Pz9a/+9S/e3t7yP/zDPxxfX1/09vbG4+Pj1c8++4xvb2/Ww7+8ffs2jscbGRnx9fV1/cQTT+jx8bE5A352djZeXl42vR3z5s2bsaO+B92/f79577P8e/zxx/Hq1av4/v37xo9J8l/Hfffdl9dff71xq6urW4tO5sXFRfzv//7vxsCwsDCeO3eucd3e3t70fPPNN83W0dExfv7555bPzMxM/PCHPzS3/j39+OOP8f7+3nwnT540t3vuuSfr8Y9//GNzaGhoCO/v79ZvvfXWrVu/Y/P44483//Of/7z1t7/9zWbN+eefb45nz541T5kyxcxf+MIXZvKkLzQ1NTXHlClTeHl5adbf//73/M///M/m4OBguLu7W1Q5e/bs3Hn58mVzaGho8Pj4uPmXvvSlmQ8//LB18+fP1/zIRz5itu/evWtcPz+/zduPfvSj+Otf/9q8f//+5gc/+EFzYGBgeHp6mj/4wQ/M9u3bm2PHjtUcHR3t/OlPfzJHjx69dP/+/fjwww+N8/Pz8eHDh7FhwwZ8++23r73w29/+1nyhhRZs27ZtVl+4cMG8Y8cOW1hYWPCnP/3JKcO4cOGCRUVFRVjR+vXr2/r111/X7R09elSTJ082v/Wtb+W+xMREU6ZMMU8ePlxyxYoVlpqaGj/zmctsMhqNLs+cOdP8+te/tk+ZMsXcsmVLv8+ZMyffZ8+eNbt7927+93//t3l6enpywO3atcs8Y8YMW9euXf37d99912zbts0qP378uK1+/OMft33xxRfWn376qfXvfve7beXl5TYzM9O+8IUvtGfMmGETJkwwe3r6/Jk3b5550KBBVuvWrau6devW9U3Tpk27rXlTpkxt+jE3Nze3KVMmdX/P9OnT3bdvX9lTTz1lfvazn+X+8ssv/5eFhYWlxcVFP7t58+b217/+tTu+j2fNmuX+/e9/u/e//vXvu3v37v/c5cuXVzVp0qS7+fn5+zds2FDdsmVLGx0dtV66dMmGhoa0Z86caU2aNKnz94xNTU3dDz/8sL3//vvdu+++212wYAG/z5w5k3vTpk17P/3pT+7YsWNn9/z83A/9j3322Sc3T5gwodvb27sPPvjgxI9+fHy8//77X/+x2b9/vzmwf//+yMvLu3xXV1c/u2zZMtPT02POnDkTu2fOnAnfvn3b2tLS0tX8/PyeHTt25FJSUtwPPvgg/9Of/jS3fPny4O3bt92lS5fivvjii9xXr14Nvvfeey99/fr15sCBA82PP/54XlFR0Zk/sLCwYNmyZc1/+Zd/aT7//PO/93n//ffNP/uzP2s+++yzz/38N8/T05O/du3a8+eff/4f+Llz55ozZsxovv766y98wz9eWFiY+aMf/ejSgQMHTu/evfvTzJkzc8aMGbN0/fr1/6bZbLbyvffe+6HlP/zDP8z9+/f/H/5pYmIi//3f/918++23f5383Xff/fD61a9+tfnss8/a1q5dm589e/Z//Lqvr29yamoqv337tvm73/3u6tdeey2/e/cu/umPfvThSxc3Nzf//fDDDx8+/Hj8+PEz1dXV/f+3V2dXV1c+Pj4+/+5//vnnX19cXBz8+vXrzw/NffDBBz+rVq36v4z3b9y48X/z/PnzX97c3Pw/f3l5eYF/7V/+5c/nz59//+eff/b29v7v/98+0+n03P/3f//v1/f29uL9/X1zYGAg7u/vf+5648+ePdv84Q9/OL/66qufHh/fv3+f+/v7X9c//vjj/N//+3+Xn/zmN186ODjoX11d3T/Xf/azn322d+/e/sNXV1cn7969a/7444+/98MPy+Xy7LvvvnN/+/btt37ttdde//z1r3/90q1bt+J++9vfrj569Ki/P/roo5/v2bMn/uUvf/n5lVde+f/o/v37X3v06NGz58+fT9fW1mZra2tzZmZmfq0/evSof9W//e1v74f/aR6Px2dnZ2d2cXHR/tGPfuTuvvtur+lX/vKXS5966il/8+bN/z3v+Wv97W9/a77xxhuvXrt2Lby+vl46ceKEnx955JGmTZs2W+vWrTMvXrzYs2fPbL5gwYJ++fn52Tdv3uzZsmWLv3//vr+trKy09+/fbxszZoyVlJS025cvX9bNnTtXX7p0Sb+PHTvWVlhYaF25csU+d+5cv3///r3/f3R0VN+nTJmivnLlyuF//ud/vPbu3dsuLCy0z5gxQ9/v3r2rP378uLWpqcl+6tSpft9//vOf/l+/fn0/+k//9E/6t2zZ0j5//vxeXl7u87vvvtuuXLnSPrVq1d1v3brVnzhxov/HH3+s7927d/cvX77cr1u3brUvv/xy+8yZM33//ffff/o5c+ZoP/vZz+z9+/d7/Xv37u3Xrl1bn3n++ef9+3//9/92t27d6j/16tXbbdu2rW5ubvZffvll//379/e///d/r7///e93j+3v/vvf99y379+fe/z4cf+zZ89WNzY29te//vX/zZ/+9Cf//vrXv+4PHz6sv3jxojd+/PHHft+7d2//tWvX+n0vvPDC7tixI/z+v5+entZXvvKVOe+9916z4eFhff/+/U2PjY01W7dunR0fH7cOHjzY3rBhQ/9Gjx5tnzt3rj906FC/37lzp314eNguXrzYb+3atd16enq0mTNn2qZMmWK/dOnSXuPGjfZ3331nX7NmTf9u3rzZvnjxYr9WrVrVe/bseX/5y1/6a/Pmzfp+/vz5duPGjY2HDx/2z549298tW7boDxs2TF91dXW9r7/+2j58+HC//vrXv/b/V6xY0T5nzhy/L1+/Xj969Gi/33///nbJkiX633nnnX5t27btvvvuu+2XX37Zr1+/fn3jxo36Dxw40L/x8fH633rrrf7Xr1/vv3PnTj948OBu2LChfejQofyDBg3y+y1btuy+++67bdq0ae3u3bvbN27c2K9cuXJ3x44dfn/q1Kl+T5w4Ue/Tpk17zXfeeWc/atSonxcuXOj//e9/73/p0qX6v/3tb+0XX3zRX7NmzfrFixc7f4q/0P7kk0/273//+/2eMGGCPn/+fP/du3f7XbhwYV/Xrl19dXV1XUvXy5Yt00uXLu3fvn27z8zMzM+lpaW6S5Yscf968uTJ/u3bt5vPnj372W9+85u/18zNzf37tWvX4ksvvZT3v//9L3/44Ycv/S+//PL3P/jggx+vWLHiH//r6+sDBw4c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';

        // Informações do PIX
        const pixInfo = `--------------------------------------
*DADOS PARA PAGAMENTO:*
*PIX BANCO (PIC PAY)*
*Gabriel lacerda Hilarino gaipo*
*Chave aleatória:*
*2044892b-5898-4352-84de-ff711f9189a3*`;

        // Dados da planilha CSV fornecida pelo usuário
        const csvData = `REFERENCIA,PRODUTO,VALOR
PM3002,PUMA 180 REVERSE,90
MA35,JORDAN LOW,73
KN521,NIKE ZOOM VOMERO 5,90
N1906A,NEW BALANCE 1906,90
N2002,NEW BALANCE 2002,88
ONRNG,ONE RUNNING,90
TMR101,TOMMY HILFIGER,73
JRD1100,JORDAN TRAVIS SCOTT,90
ADSL,ADIDAS SL72,88
ADSLN,ADIDAS SL 72 ,88
DNSUB,NIKE DN,88
LC001,LACOSTE,88
AD001,ADIDAS OZMILLEN,90
AD20900,ADIDAS CURT + MEIA,75
F8262,PUMA PALERMO,73
F19031,PUMA CAVEN,73
ADSDROP,ADIDAS DROP STEP,100
NB1080A,NEW BALANCE 1080,100
FA134,ADIDAS SPACE,73
F7411,ADIDAS,73
NB327,NEW BALANCE 327,80
F2512,NEW BALANCE 458,78
AD100/AD101,ADIDAS SAMBA XLG,78
CAD2501,ADIDAS AD2000,100
KN08,AIRMAX,85
IMAMR01,AMIRI,190
RNH1110,DUNK SB,75
IMLAC01,LACOSTE NEO,190
LC2001,LACOSTE NEW ZONE,78
IMNEW01,NEW BALANCE 1000,190
N1000A,NEW BALANCE 1000,90
IMNEW02,NEW BALANCE 2000,230
NBR301,NEW BALANCE 574,78
GNEW01,NEW BALANCE 9060,95
PD2055,PRADA MILANO,85
PR1000,PRADA MILANO,80
PRD001,PRADA MILANO,95
IMPDR01,THUNDER PRADA,190
KEDSAM01,SAMBA,75
VN2026,VANS KNUL,68
PM180,PUMA 180,90
PM3003,PUMA 180,90
NGJOR01,JORDAN LOW,80
NGDUN01,DUNK,100
NGCAMP,CAMPUS,90
NGAIR01,AIRFORCE TR,85
0126AS,ADIDAS SUPERSTAR,70
NGINVEN01,NIKE INVECIBLE,66
NGCONVER01,CONVERSE RUN,63
KEDZOOM1,NIKE ZOOM X,66
NB570,NEW BALANCE 550,100
KEDVOM01,NIKE VOMERO,66`;

        // --- ESTADO DA APLICAÇÃO ---
        let products = [];
        let budgetItems = [];

        // --- ELEMENTOS DO DOM ---
        const productListEl = document.getElementById('productList');
        const searchInput = document.getElementById('searchProduct');
        const budgetItemsEl = document.getElementById('budgetItems');
        const pesoRateInput = document.getElementById('pesoRate');
        const fretePorParInput = document.getElementById('fretePorPar');
        const productsView = document.getElementById('products-view');
        const budgetView = document.getElementById('budget-view');
        const showProductsBtn = document.getElementById('show-products-btn');
        const showBudgetBtn = document.getElementById('show-budget-btn');
        const budgetCountBadge = document.getElementById('budget-count-badge');

        // --- FUNÇÕES ---

        function parseCSV(data) {
            const lines = data.trim().split('\n');
            const header = lines.shift().split(',');
            return lines.map(line => {
                const values = line.split(',');
                return {
                    referencia: values[0].trim(),
                    produto: values[1].trim(),
                    valor: parseFloat(values[2])
                };
            });
        }

        function renderProducts(filteredProducts) {
            productListEl.innerHTML = '';
            if (filteredProducts.length === 0) {
                productListEl.innerHTML = '<p class="text-center text-gray-500 p-4">Nenhum produto encontrado.</p>';
                return;
            }
            filteredProducts.forEach(product => {
                const productEl = document.createElement('div');
                productEl.className = 'flex justify-between items-center p-3 hover:bg-gray-700 rounded-lg transition-colors duration-200';
                productEl.innerHTML = `
                    <div>
                        <p class="font-semibold">${product.produto} (${product.referencia})</p>
                        <p class="text-sm text-blue-400">R$ ${product.valor.toFixed(2)}</p>
                    </div>
                    <button data-ref="${product.referencia}" class="add-btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-1 px-3 rounded-lg transition duration-300">+</button>
                `;
                productListEl.appendChild(productEl);
            });
        }
        
        function updateSummary() {
            let subtotalProducts = 0;
            let totalPairs = 0;

            budgetItems.forEach(item => {
                subtotalProducts += item.valor * item.quantity;
                totalPairs += item.quantity;
            });
            
            const costNota = totalPairs * 1.00;
            const fretePorPar = parseFloat(fretePorParInput.value) || 0;
            const costFrete = totalPairs * fretePorPar;
            const grandTotalBRL = subtotalProducts + costNota + costFrete;
            
            const pesoRate = parseFloat(pesoRateInput.value) || 0;
            const grandTotalARS = grandTotalBRL * pesoRate;

            document.getElementById('subtotalProducts').textContent = `R$ ${subtotalProducts.toFixed(2)}`;
            document.getElementById('costNota').textContent = `R$ ${costNota.toFixed(2)}`;
            document.getElementById('costFrete').textContent = `R$ ${costFrete.toFixed(2)}`;
            document.getElementById('grandTotalBRL').textContent = `R$ ${grandTotalBRL.toFixed(2)}`;
            document.getElementById('grandTotalARS').textContent = `$ ${grandTotalARS.toFixed(2)}`;
        }
        
        function updateBadge() {
            const count = budgetItems.length;
            if (count > 0) {
                budgetCountBadge.textContent = count;
                budgetCountBadge.classList.remove('hidden');
            } else {
                budgetCountBadge.classList.add('hidden');
            }
        }

        function renderBudget() {
            budgetItemsEl.innerHTML = '';
            const emptyMessage = document.getElementById('empty-message');

            if (budgetItems.length === 0) {
                 if(emptyMessage) emptyMessage.style.display = 'table-row';
            } else {
                if(emptyMessage) emptyMessage.style.display = 'none';
                budgetItems.forEach(item => {
                    const itemEl = document.createElement('tr');
                    itemEl.className = 'border-b border-gray-700';
                    itemEl.innerHTML = `
                        <td class="p-3">
                            <p class="font-semibold">${item.produto}</p>
                            <p class="text-xs text-gray-400">${item.referencia}</p>
                        </td>
                        <td class="p-3 text-center">${item.quantity}</td>
                        <td class="p-3 text-right font-mono">R$ ${(item.valor * item.quantity).toFixed(2)}</td>
                        <td class="p-3 text-center">
                            <button data-id="${item.id}" class="remove-btn bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-2 rounded-lg text-xs">X</button>
                        </td>
                    `;
                    budgetItemsEl.appendChild(itemEl);
                });
            }
            updateSummary();
            updateBadge();
        }

        function addToBudget(ref) {
            const product = products.find(p => p.referencia === ref);
            if (product) {
                const uniqueId = crypto.randomUUID();
                budgetItems.push({ ...product, quantity: 12, id: uniqueId }); 
                renderBudget();
            }
        }
        
        function removeFromBudget(id) {
            budgetItems = budgetItems.filter(item => item.id !== id);
            renderBudget();
        }
        
        function getBudgetData() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerCity = document.getElementById('customerCity').value.trim();
            
            let totalPairs = 0;
            budgetItems.forEach(item => {
                totalPairs += item.quantity;
            });
            
            const subtotalProducts = budgetItems.reduce((acc, item) => acc + (item.valor * item.quantity), 0);
            const costNota = totalPairs * 1.00;
            const fretePorPar = parseFloat(fretePorParInput.value) || 0;
            const costFrete = totalPairs * fretePorPar;
            const grandTotalBRL = subtotalProducts + costNota + costFrete;
            const pesoRate = parseFloat(pesoRateInput.value) || 0;
            const grandTotalARS = grandTotalBRL * pesoRate;
            
            return {
                customerName, customerCity, totalPairs, subtotalProducts,
                costNota, costFrete, grandTotalBRL, pesoRate, grandTotalARS
            };
        }

        function sendWhatsAppMessage() {
            const data = getBudgetData();
            if (!data.customerName || !data.customerCity) {
                alert('Por favor, preencha o nome e a cidade do cliente.'); return;
            }
            if (budgetItems.length === 0) {
                alert('Adicione pelo menos um produto ao orçamento.'); return;
            }

            let message = `*>> NOVO ORÇAMENTO TALDOS <<*\n\n`;
            message += `*Cliente:* ${data.customerName}\n`;
            message += `*Cidade:* ${data.customerCity}\n`;
            message += `--------------------------------------\n\n`;
            message += `*ITENS DO PEDIDO:*\n\n`;

            budgetItems.forEach(item => {
                message += `*Produto:* ${item.produto} (${item.referencia})\n`;
                message += `*Qtd:* ${item.quantity} pares\n`;
                message += `*Subtotal:* R$ ${(item.valor * item.quantity).toFixed(2)}\n\n`;
            });
            
            message += `--------------------------------------\n`;
            message += `*RESUMO GERAL:*\n`;
            message += `*Total de Pares:* ${data.totalPairs}\n`;
            message += `*Subtotal Produtos:* R$ ${data.subtotalProducts.toFixed(2)}\n`;
            message += `*Nota Fiscal:* R$ ${data.costNota.toFixed(2)}\n`;
            message += `*Frete:* R$ ${data.costFrete.toFixed(2)}\n\n`;
            message += `*VALOR TOTAL (BRL): R$ ${data.grandTotalBRL.toFixed(2)}*\n`;
            if (data.pesoRate > 0) {
                 message += `*VALOR TOTAL (ARS): $ ${data.grandTotalARS.toFixed(2)}*\n`;
                 message += `_(Cotação: ${data.pesoRate.toFixed(2)})_\n`;
            }
            message += `\n${pixInfo}`;
            
            const phoneNumber = '5537998457276';
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }
        
        function generatePDF() {
            const data = getBudgetData();
            if (!data.customerName || !data.customerCity) {
                alert('Por favor, preencha o nome e a cidade do cliente.'); return;
            }
            if (budgetItems.length === 0) {
                alert('Adicione pelo menos um produto ao orçamento.'); return;
            }
            
            const doc = new jsPDF();
            
            // Adiciona a logo
            doc.addImage(logoBase64, 'PNG', 15, 10, 60, 20);

            // Título do Orçamento
            doc.setFontSize(22);
            doc.setFont('helvetica', 'bold');
            doc.text('ORÇAMENTO', 195, 20, { align: 'right' });
            
            // Data
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            const today = new Date().toLocaleDateString('pt-BR');
            doc.text(`Data: ${today}`, 195, 25, { align: 'right' });
            
            // Linha divisória
            doc.setLineWidth(0.5);
            doc.line(15, 35, 195, 35);
            
            // Informações do Cliente
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('CLIENTE:', 15, 45);
            doc.setFont('helvetica', 'normal');
            doc.text(data.customerName, 38, 45);
            doc.text(`Cidade: ${data.customerCity}`, 15, 52);

            // Tabela de Itens
            const tableColumn = ["Produto / Referência", "Qtd (Pares)", "Valor Unit.", "Subtotal"];
            const tableRows = [];
            budgetItems.forEach(item => {
                const itemData = [
                    `${item.produto} (${item.referencia})`,
                    item.quantity,
                    `R$ ${item.valor.toFixed(2)}`,
                    `R$ ${(item.valor * item.quantity).toFixed(2)}`,
                ];
                tableRows.push(itemData);
            });

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 60,
                theme: 'striped',
                headStyles: { fillColor: [31, 41, 55] } // Cor do cabeçalho
            });

            let finalY = doc.autoTable.previous.finalY + 15;

            // Resumo
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('RESUMO DO PEDIDO', 195, finalY, { align: 'right' });
            finalY += 7;
            
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            
            const summaryText = [
                [`Subtotal Produtos:`, `R$ ${data.subtotalProducts.toFixed(2)}`],
                [`Custo Nota Fiscal:`, `R$ ${data.costNota.toFixed(2)}`],
                [`Custo Frete:`, `R$ ${data.costFrete.toFixed(2)}`],
            ];
            
            summaryText.forEach(line => {
                doc.text(line[0], 150, finalY, { align: 'right' });
                doc.text(line[1], 195, finalY, { align: 'right' });
                finalY += 6;
            });
            
            doc.setLineWidth(0.2);
            doc.line(150, finalY - 2, 195, finalY - 2);

            // Total
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('TOTAL (BRL):', 150, finalY + 5, { align: 'right' });
            doc.setTextColor(0, 100, 0); // Verde
            doc.text(`R$ ${data.grandTotalBRL.toFixed(2)}`, 195, finalY + 5, { align: 'right' });
            doc.setTextColor(0); // Reseta a cor para preto

            if (data.pesoRate > 0) {
                finalY += 7;
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(`TOTAL (ARS): $ ${data.grandTotalARS.toFixed(2)} (cotação: ${data.pesoRate.toFixed(2)})`, 195, finalY + 5, { align: 'right' });
            }

            // Informações do PIX
            const pixLines = pixInfo.replace(/--------------------------------------|\*/g, '').trim().split('\n');
            finalY = doc.internal.pageSize.height - 45;
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text(pixLines[0], 15, finalY);
            finalY += 6;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            pixLines.slice(1).forEach(line => {
                doc.text(line.trim(), 15, finalY);
                finalY += 5;
            });


            // Salva o PDF
            doc.save(`Orcamento_${data.customerName.replace(/ /g, '_')}.pdf`);
        }

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            products = parseCSV(csvData);
            renderProducts(products);
            showProductsBtn.classList.add('bg-gray-700', 'text-blue-400');
        });

        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = products.filter(p => 
                p.produto.toLowerCase().includes(searchTerm) || 
                p.referencia.toLowerCase().includes(searchTerm)
            );
            renderProducts(filtered);
        });

        productListEl.addEventListener('click', (e) => {
            if (e.target.classList.contains('add-btn')) {
                addToBudget(e.target.dataset.ref);
            }
        });
        
        budgetItemsEl.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-btn')) {
                removeFromBudget(e.target.dataset.id);
            }
        });
        
        pesoRateInput.addEventListener('input', updateSummary);
        fretePorParInput.addEventListener('input', updateSummary);
        
        document.getElementById('sendWhatsApp').addEventListener('click', sendWhatsAppMessage);
        document.getElementById('generatePDF').addEventListener('click', generatePDF);

        // Lógica da Navegação Mobile
        showProductsBtn.addEventListener('click', () => {
            productsView.classList.remove('hidden');
            budgetView.classList.add('hidden');
            showProductsBtn.classList.add('bg-gray-700', 'text-blue-400');
            showBudgetBtn.classList.remove('bg-gray-700', 'text-blue-400');
        });

        showBudgetBtn.addEventListener('click', () => {
            budgetView.classList.remove('hidden');
            productsView.classList.add('hidden');
            showBudgetBtn.classList.add('bg-gray-700', 'text-blue-400');
            showProductsBtn.classList.remove('bg-gray-700', 'text-blue-400');
        });

    </script>
</body>
</html>

